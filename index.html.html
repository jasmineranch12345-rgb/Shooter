<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arena Shooter Enhanced</title>
<style>
  html, body { margin:0; padding:0; overflow:hidden; background:#111; touch-action: none; }
  canvas { display:block; background:#111; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: canvas.width/2, y: canvas.height/2, r: 20, color:'blue', speed:3, shield:0 };
let bullets = [];
let enemies = [];
let powerUps = [];
let score = 0;
let gameOver = false;

let joystick = { x: 100, y: canvas.height-100, r: 50, touchId: null, dx:0, dy:0 };
let fireButton = { x: canvas.width-100, y: canvas.height-100, r:40, active:false };

const powerUpTypes = ['rapid', 'shield', 'double'];

canvas.addEventListener('touchstart', e => {
  for(const t of e.changedTouches){
    const dx = t.clientX - joystick.x;
    const dy = t.clientY - joystick.y;
    if(Math.hypot(dx,dy) < joystick.r) joystick.touchId = t.identifier;
    const fx = t.clientX - fireButton.x;
    const fy = t.clientY - fireButton.y;
    if(Math.hypot(fx,fy) < fireButton.r) fireButton.active = true;
  }
});

canvas.addEventListener('touchmove', e => {
  for(const t of e.changedTouches){
    if(t.identifier === joystick.touchId){
      joystick.dx = t.clientX - joystick.x;
      joystick.dy = t.clientY - joystick.y;
      const dist = Math.hypot(joystick.dx, joystick.dy);
      if(dist>joystick.r){ joystick.dx = (joystick.dx/dist)*joystick.r; joystick.dy = (joystick.dy/dist)*joystick.r; }
    }
  }
});

canvas.addEventListener('touchend', e => {
  for(const t of e.changedTouches){
    if(t.identifier === joystick.touchId){
      joystick.touchId = null;
      joystick.dx = 0; joystick.dy = 0;
    }
    fireButton.active = false;
  }
});

function spawnEnemy(){
  const edge = Math.floor(Math.random()*4);
  let x, y;
  if(edge===0){ x=0; y=Math.random()*canvas.height; }
  else if(edge===1){ x=canvas.width; y=Math.random()*canvas.height; }
  else if(edge===2){ x=Math.random()*canvas.width; y=0; }
  else{ x=Math.random()*canvas.width; y=canvas.height; }
  enemies.push({x,y,r:15,color:'red'});
}

function spawnPowerUp(){
  const type = powerUpTypes[Math.floor(Math.random()*powerUpTypes.length)];
  powerUps.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:15, type, duration:500});
}

let rapidFire=0, doublePoints=0;

function update(){
  if(gameOver) return;
  const dist = Math.hypot(joystick.dx, joystick.dy);
  if(dist>5){
    player.x += (joystick.dx/dist)*player.speed;
    player.y += (joystick.dy/dist)*player.speed;
  }

  if(fireButton.active){
    if(rapidFire>0 || !fireButton.lastShot || Date.now()-fireButton.lastShot>300){
      bullets.push({x:player.x, y:player.y, dx:0, dy:-5, r:5, color:'yellow'});
      if(rapidFire>0) bullets.push({x:player.x, y:player.y, dx:-2, dy:-5, r:5, color:'yellow'});
      if(rapidFire>0) bullets.push({x:player.x, y:player.y, dx:2, dy:-5, r:5, color:'yellow'});
      fireButton.lastShot = Date.now();
    }
  }

  for(let i=bullets.length-1;i>=0;i--){
    let b = bullets[i];
    b.x += b.dx;
    b.y += b.dy;
    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) bullets.splice(i,1);
  }

  for(const e of enemies){
    const angle = Math.atan2(player.y-e.y, player.x-e.x);
    e.x += Math.cos(angle)*2;
    e.y += Math.sin(angle)*2;
    if(Math.hypot(player.x - e.x, player.y - e.y) < player.r + e.r){
      if(player.shield>0) player.shield=0; else gameOver=true;
    }
  }

  for(let i=enemies.length-1;i>=0;i--){
    for(let j=bullets.length-1;j>=0;j--){
      const e = enemies[i], b = bullets[j];
      const dist = Math.hypot(e.x-b.x,e.y-b.y);
      if(dist<e.r+b.r){
        enemies.splice(i,1);
        bullets.splice(j,1);
        score += doublePoints>0 ? 2:1;
        break;
      }
    }
  }

  for(let i=powerUps.length-1;i>=0;i--){
    const p = powerUps[i];
    if(Math.hypot(player.x-p.x, player.y-p.y)<player.r+p.r){
      if(p.type==='rapid') rapidFire = 300;
      if(p.type==='shield') player.shield=300;
      if(p.type==='double') doublePoints = 300;
      powerUps.splice(i,1);
    }
  }

  if(rapidFire>0) rapidFire--;
  if(doublePoints>0) doublePoints--;
  if(player.shield>0) player.shield--;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = player.shield>0 ? 'cyan' : player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r,0,Math.PI*2);
  ctx.fill();

  for(const b of bullets){
    ctx.fillStyle=b.color;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  }

  for(const e of enemies){
    ctx.fillStyle=e.color;
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fill();
  }

  for(const p of powerUps){
    ctx.fillStyle = p.type==='rapid'?'orange':p.type==='shield'?'cyan':'magenta';
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }

  ctx.strokeStyle='white';
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.arc(joystick.x, joystick.y, joystick.r,0,Math.PI*2);
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(joystick.x+joystick.dx, joystick.y+joystick.dy,10,0,Math.PI*2);
  ctx.fillStyle='white';
  ctx.fill();

  ctx.fillStyle='red';
  ctx.globalAlpha = fireButton.active?0.7:0.3;
  ctx.beginPath();
  ctx.arc(fireButton.x, fireButton.y, fireButton.r,0,Math.PI*2);
  ctx.fill();
  ctx.globalAlpha=1;

  ctx.fillStyle='white';
  ctx.font='24px sans-serif';
  ctx.fillText('Score: '+score,20,30);
  if(rapidFire>0) ctx.fillText('Rapid Fire!',20,60);
  if(doublePoints>0) ctx.fillText('2x Points!',20,90);
  if(player.shield>0) ctx.fillText('Shield!',20,120);

  if(gameOver){
    ctx.fillStyle='white';
    ctx.font='48px sans-serif';
    ctx.fillText('Game Over',canvas.width/2-120,canvas.height/2);
  }
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }

setInterval(spawnEnemy,2000);
setInterval(spawnPowerUp,8000);
loop();

window.addEventListener('resize',()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});
</script>
</body>
</html>